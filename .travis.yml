language: ruby
sudo: true
dist: trusty
before_script:
  - curl "https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip" -o "awscliv2.zip"
  - unzip awscliv2.zip
  - sudo ./aws/install
  - sudo rm -rf public
  - bundle exec jekyll build
deploy:
  on:
    branch: main
  provider: s3
  access_key_id: $AWS_ACCESS_KEY_ID
  secret_access_key: $AWS_SECRET_ACCESS_KEY
  bucket: melissajkipp.com
  skip_cleanup: true
  acl: public_read
  region: us-west-2
  upload-dir: public
after_deploy:
  - aws configure set preview.cloudfront true
  - aws cloudfront create-invalidation --distribution-id $CLOUDFRONT_DISTRIBUTION_ID --paths "/*"
